window._bd_share_main.F.module("trans/trans_weixin",function(n,i){var e,o,d,t="bdshare_weixin_qrcode_dialog",a="",r=0,c={},p=n("base/tangram").T,u=(n("conf/const").URLS,function(n){var i=Math.round(200/n.length);i=2>i?2:i,r=i*n.length;var e='<table style="direction:ltr;border: 0; width:'+r+'px; border-collapse: collapse;background-color:#fff;margin:0 auto;" align="center">',o=[e],d="";return p.each(n,function(n,e){o.push("<tr>"),p.each(e,function(n,e){d='<td style="width:'+i+"px;height:"+i+"px;padding:0;margin:0;border:none;background:#"+(e?"000":"FFF")+'"></td>',o.push(d)})}),o.push("</table>"),o.join("")}),s=function(n,i){window._bd_share_main.F.use("component/qrcode",function(i){var o=i.QRCode,t=i.QRErrorCorrectLevel,a=new o(-1,t.L);a.addData(n),a.make();var c=u(a.modules);p(c).appendTo(d.empty()),f(r),w(),e.attr("data-url",n)})},_=function(){e.attr("data-url")!=a&&(d.html("正在加载"),s((a.length,a)))},f=function(n){var i=(n>220?n:220)+20,o=p(".bd_weixin_popup_foot").height()+p(".bd_weixin_popup_head").height()+n+30;e.css({width:i,height:o})},h=function(){if(e=p("#"+t),o=p("#"+t+"_bg"),e.length<1){var n=['<div id="'+t+'" class="bd_weixin_popup">','<div class="bd_weixin_popup_head">',"<span>分享到微信朋友圈</span>",'<a href="#" onclick="return false;" class="bd_weixin_popup_close">&times;</a>',"</div>",'<div id="'+t+'_qr" class="bd_weixin_popup_main"></div>','<div class="bd_weixin_popup_foot">打开微信，点击底部的“发现”，<br>使用“扫一扫”即可将网页分享至朋友圈。</div>',"</div>"].join("");o=p('<iframe id="bdshare_weixin_qrcode_dialog_bg" class="bd_weixin_popup_bg"></iframe>').appendTo("body"),e=p(n).appendTo("body"),l()}d=e.find("#"+t+"_qr"),b()},l=function(){e.find(".bd_weixin_popup_close").click(g),p("body").on("keydown",function(n){27==n.keyCode&&g()}),p(window).resize(function(){w()})},w=function(){var n=p(window).scrollTop(),i=e.outerWidth(),d=e.outerHeight(),t=p(window).width(),a=p(window).height(),r=(a-d)/2+n,c=(t-i)/2;r=0>r?0:r,c=0>c?0:c,o.width(i).height(d).css({left:c,top:r}),e.css({left:c,top:r})},b=function(){e.show(),o.show(),w()},g=function(){e.hide(),o.hide()},x=function(n){var i="10006-weixin-1-52626-6b3bffd01fdde4900130bc5a2751b6d1";if("off"===c.sign)return n;if("normal"===c.sign){var e=n.indexOf("#"),o=n.indexOf("?");return-1==e?n+(-1==o?"?":"&")+i:n.replace("#",(-1==o?"?":"&")+i+"#")}return n.replace(/#.*$/g,"")+"#"+i},v=function(n){n=x(n);var i=[];return p.each(n,function(n,e){/[^\x00-\xff]/.test(e)?i[n]=encodeURI(e):i[n]=e}),n=i.join("")},m=function(){window._bd_share_main.F.use("component/pop_dialog",function(n){n.Dialog.hide()})},y=function(n){c=n,a=v(n.url),window._bd_share_main.F.use("weixin_popup.css",function(){m(),h(),_()})};i.run=y});